'use strict';
angular.module('myApp.list', ['ngRoute', 'templates'])

.config(['$routeProvider', function($routeProvider) {
  $routeProvider.when('/lists/:id/tasks', {
    templateUrl: '<%= asset_path("list.html") %>',
    controller: 'ListCtrl',
    resolve: {
      jsonGrab: ['$http', '$route', function($http, $route) {
        return $http.get('/api/lists/' + $route.current.params.id + '/tasks').then(function(response) {
          return response.data;
        });
      }],
    }
  });
}])

.controller('ListCtrl', ['$scope', 'jsonGrab', '$http', function($scope, jsonGrab, $http) {
  $scope.storeTaskList = jsonGrab.tasks;
  $scope.taskJson = jsonGrab.tasks;
  $scope.newTaskText = "";
  $scope.listJson = jsonGrab.list;

  $scope.createRoute = function(list, task){
    $http.post('/api/lists/' + list.id + '/tasks/', {text: task}).success( function(newCreatedTask){
      $scope.taskJson.push(newCreatedTask);
      $scope.newTaskText = "";
    })
  }

  $scope.hideCompleted = function(){
    function completedCheck(task){
      return !task.completed
    }
    $scope.taskJson = $scope.taskJson.filter(completedCheck)
  }

  $scope.showAll = function(){
    $scope.taskJson = $scope.storeTaskList
  }
}]);